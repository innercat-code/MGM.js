<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src="../MGM.js"></script>
</head>

<body>
    <div class="mgm info">
        <div id="stonesInfo">Stones: 0</div>
    </div>
    <script>
        const Mgm = new MGM({
            name: 'Space',
            bgCanvas: 'black',
            bgPage: '#111',
            fontColor: 'yellow',
            icon: 'Images/boat1.png',
            autorun: true,
            vars: {
                widthPlane: 3000,
                stones: 10,
            }
        })

        Mgm.object.scene = {
            drawRect: {
                x: -Mgm.widthPlane,
                y: -Mgm.widthPlane,
                width: Mgm.widthPlane * 2,
                height: Mgm.widthPlane * 2,
                lineColor: 'yellow',
                lineWidth: 3,
                pattern: [10, 30]
            }
        }

        // star
        Mgm.object.star = {
            pic: 'Images/a1.png',
            active: false,
            z: -1,
            noContact: true,
        }
        Mgm.object.star.start = th => {
            for (let i = 0; i < 1000; i++) {
                let r = Mgm.random(1, 10) / 10
                th.clone({
                    x: Mgm.random(-Mgm.widthPlane, Mgm.widthPlane),
                    y: Mgm.random(-Mgm.widthPlane, Mgm.widthPlane),
                    active: true,
                    size: r,
                    cameraZ: r,
                })
            }
        }

        // unit
        Mgm.object.unit = {
            pic: 'Images/boat1.png',
            camera: true,
            anglePic: true,
            // to: { x: 0, y: 0 },
            inMgm: 'unit',
            tShot: 0,
            hp: 100,
            drawText: {
                color: 'white',
                size: 12,
                absolute: true,
                y: 30,
                align: 'center',
            }
        }
        Mgm.object.unit.update = th => {
            if (Mgm.keys.d) th.angle += 3
            if (Mgm.keys.a) th.angle -= 3
            if (Mgm.keys.w) th.step(5)
            if (Mgm.keys.s) th.step(-2)
            if (th.x < -Mgm.widthPlane + 30) th.x = -Mgm.widthPlane + 30
            if (th.x > Mgm.widthPlane - 30) th.x = Mgm.widthPlane - 30
            if (th.y < -Mgm.widthPlane + 30) th.y = -Mgm.widthPlane + 30
            if (th.y > Mgm.widthPlane - 30) th.y = Mgm.widthPlane - 30
            if (Mgm.keys.space)
                if (th.tShot == 0) {
                    Mgm.clone({
                        name: 'bullet',
                        active: true,
                        x: th.x,
                        y: th.y,
                        angle: th.angle,
                    })
                    th.tShot = 5
                } else th.tShot--
            th.drawText.text = th.hp
            if (hp = th.contact('HP')) {
                hp.delete()
                th.hp = 100
            }
            if (th.hp <= 0) {
                Mgm.stop('<h1>Game over</h1>')
            }
        }

        // unit bullet
        Mgm.object.bullet = {
            drawCircle: {
                radius: 2,
                fillColor: 'lightblue'
            },
            active: false,
            tExist: 0
        }
        Mgm.object.bullet.update = th => {
            th.step(15)
            if (e = th.contact('enemy')) {
                th.delete()
                e.hp -= 5
            }
            if (s = th.contact('stone')) {
                th.delete()
                s.hp -= 1
            }
            th.tExist++
            if (th.tExist == 200) th.delete()
        }

        // enemy
        Mgm.object.enemy = {
            pic: 'Images/boat1.png',
            active: false,
            anglePic: true,
            tShot: 0,
            hp: 100,
            // border: 'line, red',
            drawText: {
                color: 'white',
                size: 12,
                absolute: true,
                y: 30,
                align: 'center',
            }
        }
        Mgm.object.enemy.start = th => {
            for (let i = 0; i < 50; i++)
                th.clone({
                    x: Mgm.random(-Mgm.widthPlane * 0.8, Mgm.widthPlane * 0.8),
                    y: Mgm.random(-Mgm.widthPlane * 0.8, Mgm.widthPlane * 0.8),
                })
        }
        Mgm.object.enemy.update = th => {
            let d = th.distanceTo('unit')
            if (d < 500) {
                th.angle = th.angleTo('unit')
                if (d > 200) th.step(2)
                if (th.tShot == 0) {
                    th.tShot = 100
                    Mgm.clone({
                        name: 'bullet2',
                        active: true,
                        x: th.x,
                        y: th.y,
                        angle: th.angle,
                    })
                } else th.tShot--
            }
            th.drawText.text = th.hp
            if (th.hp <= 0) {
                th.delete()
                Mgm.piece.boom(th, 'red', 50)
            }
        }

        // enemy bullet
        Mgm.object.bullet2 = {
            drawCircle: {
                radius: 4,
                fillColor: 'red'
            },
            active: false,
            tExist: 0
        }
        Mgm.object.bullet2.update = th => {
            th.step(5)
            if (u = th.contact('unit')) {
                th.delete()
                u.hp -= 5
            }
            th.tExist++
            if (th.tExist == 100) th.delete()
        }

        // unit plus hp
        Mgm.object.HP = {
            y: 100,
            drawRect: [
                {
                    x: -15,
                    y: -5,
                    width: 30,
                    height: 10,
                    fillColor: 'red',
                },
                {
                    x: -5,
                    y: -15,
                    width: 10,
                    height: 30,
                    fillColor: 'red',
                }
            ],
            drawCircle: {
                radius: 20,
                lineColor: 'red'
            },
            active: false
        }
        Mgm.object.HP.start = th => {
            for (let i = 0; i < 10; i++)
                th.clone({
                    x: Mgm.random(-Mgm.widthPlane * 0.8, Mgm.widthPlane * 0.8),
                    y: Mgm.random(-Mgm.widthPlane * 0.8, Mgm.widthPlane * 0.8),
                })
        }
        Mgm.object.HP.update = th => {
            th.rotation += 2
        }

        // space stone
        Mgm.object.stone = {
            drawRect: {
                x: -35,
                y: -35,
                width: 70,
                height: 70,
                fillColor: '#555'
            },
            drawText: {
                color: 'white',
                size: 12,
                absolute: true,
                y: 50,
                align: 'center',
            },
            active: false,
            hp: 100,
            width: 70,
            height: 70,
            speedRot: Mgm.random(-10, 10) / 10
        }
        Mgm.object.stone.start = th => {
            for (let i = 0; i < Mgm.stones; i++)
                th.clone({
                    x: Mgm.random(-Mgm.widthPlane * 0.8, Mgm.widthPlane * 0.8),
                    y: Mgm.random(-Mgm.widthPlane * 0.8, Mgm.widthPlane * 0.8),
                })
            Mgm.stonesInfo.innerHTML = 'Stones: ' + Mgm.stones
        }
        Mgm.object.stone.update = th => {
            th.rotation += th.speedRot
            th.drawText.text = th.hp
            if (th.hp <= 0) {
                th.delete()
                Mgm.piece.boom(th, '#555', 150)
                Mgm.stones--
                Mgm.stonesInfo.innerHTML = 'Stones: ' + Mgm.stones
                if (Mgm.stones == 0) Mgm.stop('!!! YOU WIN !!!')
            }
        }

        // piece
        Mgm.object.piece = {
            inMgm: 'piece',
            active: false,
            speed: 0,
            drawCircle: {
                radius: 10,
                fillColor: '#555',
                absolute: true,
            },
        }
        Mgm.object.piece.update = th => {
            th.step(th.speed)
            if (th.drawCircle.radius <= 0.1) th.delete()
            else th.drawCircle.radius -= 0.1
        }
        Mgm.object.piece.boom = (obj, color, max) => {
            for (let i = 0; i < Mgm.random(max / 5, max); i++) {
                let piece = Mgm.clone({
                    name: 'piece',
                    x: obj.x,
                    y: obj.y,
                    active: true,
                    angle: Mgm.random(0, 360),
                    speed: Mgm.random(1, 10),
                })
                piece.drawCircle.radius = Mgm.random(max / 20, max / 5)
                piece.drawCircle.fillColor = color
            }
        }


    </script>
</body>

</html>